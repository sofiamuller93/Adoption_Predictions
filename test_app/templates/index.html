<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Animal Adoptions</title>
   
</head>

<body>

    <h1>Upload new File</h1>
    <!-- <form id="uploadForm" method="post"  action="#" enctype="multipart/form-data">
    <p><input id="file" type=file name="file">
    <input type=submit value=Upload>
    </form> -->

    <input type="file" accept="image/jpg,image/png" style="display:none" id="upload-file" />
    <button id="choose-button">Choose Image</button>

    <div id="plotAge"></div>
    <div id="plotColor"></div>

    <!-- {% for pet in data %}
        <h2 id="breed{{pet.id}}">{{pet.breed}}</h2>
        <div id="plot{{pet.id}}"></div>
        <div id=plotgender{{pet.id}}></div>
    {% endfor %} -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.5.0/d3.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>

        document.querySelector('#choose-button').addEventListener('click', function() {
	    document.querySelector('#upload-file').click();
        });

        document.querySelector('#upload-file').file

        document.querySelector('#upload-file').addEventListener('change', function() {
	// This is the file user has chosen
	        var file = this.file;

	// In case of multiple files
        });
        document.querySelector('#upload-file').addEventListener('change', function() {
	// This is the file user has chosen
	var file = this.file;

	// Allowed types
	var mime_types = [ 'image/jpeg', 'image/png' ];
	
	// Validate MIME type
	if(mime_types.indexOf(file.type) == -1) {
		alert('Error : Incorrect file type');
		return;
	}

	// Max 2 Mb allowed
	if(file.size > 2*1024*1024) {
		alert('Error : Exceeded size 2MB');
		return;
	}

	// Validation is successful
	// This is the name of the file
    alert('You have chosen the file ' + file.name);
    console.log(data)
});
        
        var data = new FormData();

        var request = new XMLHttpRequest();

// File selected by the user
// In case of multiple files append each of them
        data.append('file', document.querySelector('#file'));

// AJAX request finished
        request.addEventListener('load', function(e) {
	// request.response will hold the response from the server
            console.log(request.response);
            // json_data = request.response;
        });

// Upload progress on request.upload
        request.upload.addEventListener('progress', function(e) {
	    var percent_complete = (e.loaded / e.total)*100;
	
	// Percentage of upload completed
	        console.log(percent_complete);
        });

// If server is sending a JSON response then set JSON response type
        request.responseType = 'json';

// Send POST request to the server side script
        request.open('post', '/upload_file'); 
        request.send(data);
    // var breed = "Pit Bull Mix" 
    // d3.json('/data/' + breed).then(function(data) {
    //     console.log(data);

    //     var trace = {
    //         x: data.age_range,
    //         type: 'histogram',
    //     };
    //     var data = [trace];
    //     Plotly.newPlot('plotAge', data);

    // });

    // function buildPlot(breed, id) {

    //         d3.json('/data/' + breed).then(function (data) {

    //             console.log(data);
    //             var trace1 = {
    //                 x: data.x,
    //                 y: data.y,
    //                 type: "bar"
    //             };

    //             var data = [trace1];

    //             var layout = {
    //                 title: data.title
    //             };

    //             Plotly.newPlot("plot"+id, data, layout);

    //         });
    //     }

    // function buildgenderPlot(breed, id) {

    //         d3.json('/gender/' + breed).then(function (data) {

    //             console.log(data);
    //             var trace1 = {
    //                 x: data.x,
    //                 y: data.y,
    //                 type: "bar"
    //             };


    //             var data = [trace1];

    //             var layout = {
    //                 title: data.title
    //             };

    //             Plotly.newPlot("plotgender"+id, data, layout);

    //         });
    //         }
        
    var breed1 = d3.select("#breed1").text()
    buil/dPlot(breed1, 1)

    var breed2 = d3.select("#breed2").text()
    buildPlot(breed2, 2)

    
    buildgenderPlot(breed1, 1)

    </script>

</body>

</html>